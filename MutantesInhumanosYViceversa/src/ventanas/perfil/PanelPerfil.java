package ventanas.perfil;

import mensajes.entidades.Hijos;
import mensajes.entidades.Interes;
import mensajes.entidades.Relacion;
import mensajes.entidades.Sexo;
import mensajes.entidades.Usuario;
import mensajes.MsjServCargaVentana;
import mensajes.MsjServUsuario;
import java.awt.Image;
import java.io.File;
import javax.swing.DefaultComboBoxModel;
import javax.swing.ImageIcon;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileNameExtensionFilter;
import utilidades.Constantes;

/**
 *
 * @author Flor
 */
public class PanelPerfil extends javax.swing.JPanel {

    private Usuario usuario = null;

    /**
     * Creates new form PanelPerfil
     *
     * @param usuario
     */
    public PanelPerfil(Usuario usuario) {
        initComponents();

        //Rellenamos los combos
        rellenarCombos();

        //Cargamos la informacion
        cargarInformacion(usuario);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lbl_foto = new javax.swing.JLabel();
        btn_selec_foto = new javax.swing.JButton();
        lbl_datos = new javax.swing.JLabel();
        jSeparator2 = new javax.swing.JSeparator();
        lbl_nick = new javax.swing.JLabel();
        txt_nick = new javax.swing.JTextField();
        lbl_email = new javax.swing.JLabel();
        txt_email = new javax.swing.JTextField();
        lbl_pwd = new javax.swing.JLabel();
        txt_pwd = new javax.swing.JPasswordField();
        lbl_titulo_pref = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        lbl_relacion = new javax.swing.JLabel();
        cb_relacion = new javax.swing.JComboBox<>();
        lbl_deportivos = new javax.swing.JLabel();
        lbl_deporte_menos = new javax.swing.JLabel();
        sl_deportivo = new javax.swing.JSlider();
        lbl_deporte_mas = new javax.swing.JLabel();
        lbl_artistico = new javax.swing.JLabel();
        lbl_arte_menos = new javax.swing.JLabel();
        sl_artisticos = new javax.swing.JSlider();
        lbl_arte_mas = new javax.swing.JLabel();
        lbl_politicos = new javax.swing.JLabel();
        lbl_politico_menos = new javax.swing.JLabel();
        sl_politicos = new javax.swing.JSlider();
        lbl_politico_mas = new javax.swing.JLabel();
        lbl_hijos = new javax.swing.JLabel();
        cb_hijos = new javax.swing.JComboBox<>();
        lbl_interes = new javax.swing.JLabel();
        lbl_sexo = new javax.swing.JLabel();
        cb_sexo = new javax.swing.JComboBox<>();
        cb_interes = new javax.swing.JComboBox<>();
        btn_guardar = new javax.swing.JButton();

        setBackground(new java.awt.Color(155, 131, 131));
        setMinimumSize(new java.awt.Dimension(970, 510));
        setOpaque(false);
        setPreferredSize(new java.awt.Dimension(970, 510));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lbl_foto.setBackground(new java.awt.Color(204, 204, 204));
        lbl_foto.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(232, 195, 158), 2));
        lbl_foto.setOpaque(true);
        add(lbl_foto, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 60, 130, 130));

        btn_selec_foto.setBackground(new java.awt.Color(249, 246, 246));
        btn_selec_foto.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        btn_selec_foto.setText("Sel. Foto");
        btn_selec_foto.setToolTipText("Seleccionar foto");
        btn_selec_foto.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_selec_fotoActionPerformed(evt);
            }
        });
        add(btn_selec_foto, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 200, 130, -1));

        lbl_datos.setFont(new java.awt.Font("Book Antiqua", 1, 22)); // NOI18N
        lbl_datos.setForeground(new java.awt.Color(255, 255, 255));
        lbl_datos.setText("Datos personales");
        add(lbl_datos, new org.netbeans.lib.awtextra.AbsoluteConstraints(735, 10, -1, -1));
        add(jSeparator2, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 40, 900, 10));

        lbl_nick.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_nick.setForeground(new java.awt.Color(255, 255, 255));
        lbl_nick.setText("Nick:");
        add(lbl_nick, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 82, -1, -1));

        txt_nick.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(txt_nick, new org.netbeans.lib.awtextra.AbsoluteConstraints(440, 80, 250, -1));

        lbl_email.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_email.setForeground(new java.awt.Color(255, 255, 255));
        lbl_email.setText("Email:");
        add(lbl_email, new org.netbeans.lib.awtextra.AbsoluteConstraints(370, 122, -1, -1));

        txt_email.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(txt_email, new org.netbeans.lib.awtextra.AbsoluteConstraints(440, 120, 250, -1));

        lbl_pwd.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_pwd.setForeground(new java.awt.Color(255, 255, 255));
        lbl_pwd.setText("Contraseña:");
        add(lbl_pwd, new org.netbeans.lib.awtextra.AbsoluteConstraints(320, 162, -1, -1));

        txt_pwd.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(txt_pwd, new org.netbeans.lib.awtextra.AbsoluteConstraints(440, 160, 250, -1));

        lbl_titulo_pref.setFont(new java.awt.Font("Book Antiqua", 1, 22)); // NOI18N
        lbl_titulo_pref.setForeground(new java.awt.Color(255, 255, 255));
        lbl_titulo_pref.setText("Preferencias");
        add(lbl_titulo_pref, new org.netbeans.lib.awtextra.AbsoluteConstraints(780, 220, -1, -1));
        add(jSeparator1, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 250, 900, 10));

        lbl_relacion.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_relacion.setForeground(new java.awt.Color(255, 255, 255));
        lbl_relacion.setText("Relación:");
        add(lbl_relacion, new org.netbeans.lib.awtextra.AbsoluteConstraints(132, 270, -1, -1));

        cb_relacion.setBackground(new java.awt.Color(249, 246, 246));
        cb_relacion.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(cb_relacion, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 270, 250, -1));

        lbl_deportivos.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_deportivos.setForeground(new java.awt.Color(255, 255, 255));
        lbl_deportivos.setText("Deportivos:");
        add(lbl_deportivos, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 270, -1, -1));

        lbl_deporte_menos.setIcon(new javax.swing.ImageIcon(getClass().getResource("/recursos/ico/ico_menos.png"))); // NOI18N
        add(lbl_deporte_menos, new org.netbeans.lib.awtextra.AbsoluteConstraints(630, 270, -1, -1));

        sl_deportivo.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(sl_deportivo, new org.netbeans.lib.awtextra.AbsoluteConstraints(672, 270, 150, 35));

        lbl_deporte_mas.setIcon(new javax.swing.ImageIcon(getClass().getResource("/recursos/ico/ico_mas.png"))); // NOI18N
        add(lbl_deporte_mas, new org.netbeans.lib.awtextra.AbsoluteConstraints(830, 270, -1, -1));

        lbl_artistico.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_artistico.setForeground(new java.awt.Color(255, 255, 255));
        lbl_artistico.setText("Artísticos:");
        add(lbl_artistico, new org.netbeans.lib.awtextra.AbsoluteConstraints(510, 350, -1, -1));

        lbl_arte_menos.setIcon(new javax.swing.ImageIcon(getClass().getResource("/recursos/ico/ico_menos.png"))); // NOI18N
        add(lbl_arte_menos, new org.netbeans.lib.awtextra.AbsoluteConstraints(630, 350, -1, -1));

        sl_artisticos.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(sl_artisticos, new org.netbeans.lib.awtextra.AbsoluteConstraints(672, 350, 150, 35));

        lbl_arte_mas.setIcon(new javax.swing.ImageIcon(getClass().getResource("/recursos/ico/ico_mas.png"))); // NOI18N
        add(lbl_arte_mas, new org.netbeans.lib.awtextra.AbsoluteConstraints(830, 350, -1, -1));

        lbl_politicos.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_politicos.setForeground(new java.awt.Color(255, 255, 255));
        lbl_politicos.setText("Políticos:");
        add(lbl_politicos, new org.netbeans.lib.awtextra.AbsoluteConstraints(520, 310, -1, -1));

        lbl_politico_menos.setIcon(new javax.swing.ImageIcon(getClass().getResource("/recursos/ico/ico_menos.png"))); // NOI18N
        add(lbl_politico_menos, new org.netbeans.lib.awtextra.AbsoluteConstraints(630, 310, -1, -1));

        sl_politicos.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(sl_politicos, new org.netbeans.lib.awtextra.AbsoluteConstraints(672, 310, 150, 35));

        lbl_politico_mas.setIcon(new javax.swing.ImageIcon(getClass().getResource("/recursos/ico/ico_mas.png"))); // NOI18N
        add(lbl_politico_mas, new org.netbeans.lib.awtextra.AbsoluteConstraints(830, 310, -1, -1));

        lbl_hijos.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_hijos.setForeground(new java.awt.Color(255, 255, 255));
        lbl_hijos.setText("Tiene/Quiere hijos:");
        add(lbl_hijos, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 310, -1, -1));

        cb_hijos.setBackground(new java.awt.Color(249, 246, 246));
        cb_hijos.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(cb_hijos, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 310, 250, -1));

        lbl_interes.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_interes.setForeground(new java.awt.Color(255, 255, 255));
        lbl_interes.setText("Interés en:");
        add(lbl_interes, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 396, -1, -1));

        lbl_sexo.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        lbl_sexo.setForeground(new java.awt.Color(255, 255, 255));
        lbl_sexo.setText("Sexo:");
        add(lbl_sexo, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 353, -1, -1));

        cb_sexo.setBackground(new java.awt.Color(249, 246, 246));
        cb_sexo.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(cb_sexo, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 350, 250, -1));

        cb_interes.setBackground(new java.awt.Color(249, 246, 246));
        cb_interes.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        add(cb_interes, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 390, 250, -1));

        btn_guardar.setBackground(new java.awt.Color(249, 246, 246));
        btn_guardar.setFont(new java.awt.Font("Book Antiqua", 1, 20)); // NOI18N
        btn_guardar.setText("Guardar");
        btn_guardar.setToolTipText("Guardar");
        btn_guardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_guardarActionPerformed(evt);
            }
        });
        add(btn_guardar, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 460, 390, -1));
    }// </editor-fold>//GEN-END:initComponents

    private void btn_selec_fotoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_selec_fotoActionPerformed
        //Muestra el cuadro de dialogo para seleccionar imagenes
        JFileChooser selectorArchivos = new JFileChooser();
        FileNameExtensionFilter filtroImagen = new FileNameExtensionFilter("JPG, PNG", "jpg", "png");
        selectorArchivos.setFileFilter(filtroImagen);
        selectorArchivos.showOpenDialog(this);
        File archivo = selectorArchivos.getSelectedFile();

        //En caso de seleccionar un documento lo guarda en el objeto a enviar
        if (null != archivo) {
            String origen = archivo.getPath();
            ImageIcon icon = new ImageIcon(origen);
            //Redimensionamos la imagen al espacio del label
            Image image = icon.getImage();
            //Se ecala de manera suave
            Image newimg = image.getScaledInstance(420, 360, java.awt.Image.SCALE_SMOOTH);

            //Se escala de manera suave para mostrarla
            Image imgLbl = newimg.getScaledInstance(130, 130, java.awt.Image.SCALE_SMOOTH);
            icon = new ImageIcon(imgLbl);
            //Pasamos la imgane al label
            this.lbl_foto.setIcon(icon);
            
            //Almacenamos la imagen en el usuario para almacenarla con una escala grande
            usuario.setFoto(icon);
        }
    }//GEN-LAST:event_btn_selec_fotoActionPerformed

    private void btn_guardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_guardarActionPerformed
        //Obtenemos la informacion de la ventana
        MsjServUsuario mUsuario = new MsjServUsuario();
        mUsuario.setAccion(Constantes.ACCION_GUARDAR_PREFERENCIAS);
        //Obtenemos la informacion de la ventana
        informacionVentana();
        mUsuario.setUsuario(usuario);

        //Segun el codigo devuelto por el servidor redirige o muestra un mensaje
        switch (mUsuario.getCodError()) {
            case Constantes.OK:
                JOptionPane.showMessageDialog(this, mUsuario.getMensaje(), "Perfil", JOptionPane.INFORMATION_MESSAGE);
                break;
            case Constantes.ERROR_NO_NICK:
            case Constantes.ERROR_FORMATO_EMAIL:
            case Constantes.ERROR_PWD:
            case Constantes.ERROR_NO_FOTO:
            case Constantes.ERROR_BD:
                //Mostramos el mensaje devuelto por el servidor
                JOptionPane.showMessageDialog(this, mUsuario.getMensaje(), "Perfil", JOptionPane.ERROR_MESSAGE);
                break;
        }
    }//GEN-LAST:event_btn_guardarActionPerformed

    /**
     * Rellena la informacion de los combos
     */
    private void rellenarCombos() {

        DefaultComboBoxModel modelRelacion = new DefaultComboBoxModel();
        cb_relacion.setModel(modelRelacion);

        DefaultComboBoxModel modelHijos = new DefaultComboBoxModel();
        cb_hijos.setModel(modelHijos);

        DefaultComboBoxModel modelSexo = new DefaultComboBoxModel();
        cb_sexo.setModel(modelSexo);

        DefaultComboBoxModel modelInteres = new DefaultComboBoxModel();
        cb_interes.setModel(modelInteres);

        //cb_relacion.setModel(mdljComboBox);
        MsjServCargaVentana mServCargaVentana = new MsjServCargaVentana();

        //Segun el codigo devuelto por el servidor redirige o muestra un mensaje
        switch (mServCargaVentana.getCodError()) {
            case Constantes.OK:

                for (Relacion relacion : mServCargaVentana.getListaRelacion()) {
                    //Relacion
                    modelRelacion.addElement(relacion);
                }
                for (Hijos hijos : mServCargaVentana.getListaHijos()) {
                    //Hijos
                    modelHijos.addElement(hijos);
                }
                for (Sexo sexo : mServCargaVentana.getListaSexo()) {
                    //Sexo
                    modelSexo.addElement(sexo);
                }
                for (Interes interes : mServCargaVentana.getListaInteres()) {
                    //Interes
                    modelInteres.addElement(interes);
                }

                break;
            case Constantes.ERROR_BD:
                //Mostramos el mensaje devuelto por el servidor
                JOptionPane.showMessageDialog(this, mServCargaVentana.getMensaje(), "Preferencias", JOptionPane.ERROR_MESSAGE);
                break;
        }
    }

    /**
     * Cargamos la informacion del usuario en la pantalla
     *
     * @param usuario
     */
    private void cargarInformacion(Usuario usuario) {
        this.usuario = usuario;

        //Datos personales
        if (null != usuario.getFoto()) {
            //Se ecala de manera suave
            Image newimg = usuario.getFoto().getImage().getScaledInstance(130, 130, java.awt.Image.SCALE_SMOOTH);
            ImageIcon icon = new ImageIcon(newimg);
            //Pasamos la imgane al label
            this.lbl_foto.setIcon(icon);
        }
        txt_nick.setText(usuario.getNick());
        txt_email.setText(usuario.getEmail());
        txt_pwd.setText(usuario.getPwd());

        //Preferencias
        cb_relacion.setSelectedIndex(usuario.getRelacion()-1);
        sl_deportivo.setValue(usuario.getDeporte());
        sl_artisticos.setValue(usuario.getArte());
        sl_politicos.setValue(usuario.getPolitica());
        cb_hijos.setSelectedIndex(usuario.getHijos()-1);
        cb_sexo.setSelectedIndex(usuario.getSexo()-1);
        cb_interes.setSelectedIndex(usuario.getInteres()-1);
    }

    /**
     * Obtiene la informacion de la ventana y la pasa al usuario
     */
    private void informacionVentana() {

        String nick = txt_nick.getText();
        usuario.setNick(nick);
        String email = txt_email.getText();
        usuario.setEmail(email);
        char[] pwd = txt_pwd.getPassword();
        if (0 < pwd.length) {
            usuario.setPwd(String.valueOf(pwd));
        }
        Relacion relacion = (Relacion) cb_relacion.getSelectedItem();
        usuario.setRelacion(relacion.getId());
        int deporte = sl_deportivo.getValue();
        usuario.setDeporte(deporte);
        int arte = sl_artisticos.getValue();
        usuario.setArte(arte);
        int politica = sl_politicos.getValue();
        usuario.setPolitica(politica);
        Hijos hijos = (Hijos) cb_hijos.getSelectedItem();
        usuario.setHijos(hijos.getId());
        Sexo sexo = (Sexo) cb_sexo.getSelectedItem();
        usuario.setSexo(sexo.getId());
        Interes interes = (Interes) cb_interes.getSelectedItem();
        usuario.setInteres(interes.getId());
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_guardar;
    private javax.swing.JButton btn_selec_foto;
    private javax.swing.JComboBox<String> cb_hijos;
    private javax.swing.JComboBox<String> cb_interes;
    private javax.swing.JComboBox<String> cb_relacion;
    private javax.swing.JComboBox<String> cb_sexo;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JLabel lbl_arte_mas;
    private javax.swing.JLabel lbl_arte_menos;
    private javax.swing.JLabel lbl_artistico;
    private javax.swing.JLabel lbl_datos;
    private javax.swing.JLabel lbl_deporte_mas;
    private javax.swing.JLabel lbl_deporte_menos;
    private javax.swing.JLabel lbl_deportivos;
    private javax.swing.JLabel lbl_email;
    private javax.swing.JLabel lbl_foto;
    private javax.swing.JLabel lbl_hijos;
    private javax.swing.JLabel lbl_interes;
    private javax.swing.JLabel lbl_nick;
    private javax.swing.JLabel lbl_politico_mas;
    private javax.swing.JLabel lbl_politico_menos;
    private javax.swing.JLabel lbl_politicos;
    private javax.swing.JLabel lbl_pwd;
    private javax.swing.JLabel lbl_relacion;
    private javax.swing.JLabel lbl_sexo;
    private javax.swing.JLabel lbl_titulo_pref;
    private javax.swing.JSlider sl_artisticos;
    private javax.swing.JSlider sl_deportivo;
    private javax.swing.JSlider sl_politicos;
    private javax.swing.JTextField txt_email;
    private javax.swing.JTextField txt_nick;
    private javax.swing.JPasswordField txt_pwd;
    // End of variables declaration//GEN-END:variables
}
